# ssl-demo

Demo integrating gittuf, SBOMit, and RSTUF in one workflow

## Requirements

- [gittuf](https://github.com/gittuf/gittuf)
- [in-toto](https://github.com/in-toto/in-toto)
- [sbdx-sbom-generator](https://github.com/opensbom-generator/spdx-sbom-generator)
- [protobomit](https://github.com/SBOMit/protobomit)
- [RSTUF](https://github.com/repository-service-tuf/repository-service-tuf)

## Demo steps

### gittuf setup

- [x] Create a new temporary repository
- [x] Delegate permission for branch updates on main
- [x] Create code of a binary that can be built
- [x] Commit the change by the delegated user

### Demo repository

- [x] Clone the gittuf repository using gittuf
- [x] Alice creates in-toto policy metadata that includes Bob
- [x] Bob creates in-toto metadata wrapping the build step
- [x] Generate SBOM as part of the build step abstracted in make
- [x] Alice verifies in-toto metadata generated by Bob
- [ ] Add the generated in-toto attestation using protobomit
- [ ] Push metadata to locally running RSTUF server
- [ ] Move build artifacts to temporary folder for download later
- [ ] Client downloads in-toto metadata from RSTUF server
- [ ] Client checks out code from temporary repository
- [ ] Verify product on the client after downloading

### Not handled yet

- protobomit throws given in-toto attestation file
- Check if Witness should be used to generate attestation
- Anything to do with RSTUF

## Install

``` sh
# Install dependencies
pip install -r requirements.txt
```

## Running the demo

``` sh
python run-demo.py
```

### Manual commands

Manually running the demo

``` sh
# Create the policy layout
python owner-alice/create-layout.py

# in-toto metadata for the build
in-toto-run \
    --step-name build \
    --use-dsse \
    --products gittuf-delegation/hello \
    --key functionary-bob/bob \
    -- make build

# Client verification
in-toto-verify \
    --layout root.layout \
    --layout-key owner-alice/alice.pub

# Add in-toto metadata to SBOM
# Check it's fine to use Bob's public key
protobomit generate \
    --sbom gittuf-delegation/bom-go-mod.spdx \
    --attestation build.776a00e2.link \
    --policy root.layout \
    --publicKey ./functionary-bob/bob.pub
```
