# ssl-demo

Demo integrating gittuf, SBOMit, and RSTUF in one workflow

## Requirements

- [gittuf](https://github.com/gittuf/gittuf)
- [in-toto](https://github.com/in-toto/in-toto)
- [Witness](https://github.com/in-toto/witness)
- [protobomit](https://github.com/SBOMit/protobomit)
- [RSTUF](https://github.com/repository-service-tuf/repository-service-tuf)

## Demo steps

### gittuf setup

- [x] Create a new temporary repository
- [x] Delegate permission for branch updates on main
- [x] Create code of a binary that can be built
- [x] Commit the change by the delegated user

### Demo repository

- [x] Clone the gittuf repository using gittuf
- [x] Alice creates in-toto policy metadata that includes Bob
- [x] Bob creates in-toto metadata wrapping the build step
- [x] Generate SBOM as part of the build step abstracted in make
- [x] Alice verifies in-toto metadata generated by Bob
- [x] Add the generated in-toto attestation using protobomit
- [ ] Push metadata to locally running RSTUF server
- [ ] Move build artifacts to temporary folder for download later
- [ ] Client downloads in-toto metadata from RSTUF server
- [ ] Client checks out code from temporary repository
- [ ] Verify product on the client after downloading

### Not handled yet

Anything to do with RSTUF

## Install

``` sh
# Install dependencies
pip install -r requirements.txt
```

## Running the demo

``` sh
python run-demo.py

# Remove generated files
python run-demo.py --clean
```

*Note: There is a `run-alt-demo.py` script that can be used separately for
running a demo which generates in-toto metadata using the Python reference
implementation of in-toto. The alternate demo doesn't incorporate protobomit
because it requires Witness generated attestations.*

### Manual commands

Manually running the demo

``` sh
# Generate in-toto metadata for the build
# using Witness required by protobomit
witness run \
    --step build \
    -o test-att.json \
    --signer-file-key-path testkey.pem \
    -- make build

# Client verification
witness verify \
    -f gittuf-delegation/bom-go-mod.json \
    -a test-att.json \
    -p policy-signed.json \
    -k testpub.pem

# Crete new SBOM with metadata
protobomit generate \
    --sbom gittuf-delegation/bom-go-mod.json \
    --attestation test-att.json \
    --policy policy-signed.json \
    --publicKey testpub.pem
```
